<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>H-Focus Medical Laboratory | Check Patient's Result</title>

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="images/red.png" />

  <!-- Vendor CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" />
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

  <!-- Main Site Styles -->
  <link rel="stylesheet" href="styles/styles.css" />
</head>

<body class="body-loader">
  <!-- Page Loader -->
  <div class="page-loader">
    <div class="spinner-border text-danger" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <section class="wrapper">
    <!-- Header -->
    <header class="hero-anime">
      <div class="navigation-wrap start-header start-style">
        <div class="sub-nav border-bottom">
          <div class="container d-flex justify-content-between">
            <div class="d-flex justify-content-between">
              <a class="p-2 border-right border-left text-black" href="tel:0700 225 4365, 0700 CAL HFML"><i class="fas fa-phone-alt mr-2"></i> Phone: 0700 225 4365, 0700 CAL HFML</a>
              <a class="p-2 border-right text-black" href="mailto:support@hfocusmedical.com"><i class="fas fa-envelope mr-2"></i> Email: support@hfocusmedical.com</a>
            </div>
            <div class="d-flex justify-content-between">
              <a class="px-3 py-2 border-right border-left text-center text-black" target="_blank" href="https://web.facebook.com/hfocusmedical/"><i class="fab fa-facebook"></i></a>
              <a class="px-3 py-2 border-right text-black text-center" target="_blank" href="https://x.com/h_medicare"><i class="fab fa-twitter"></i></a>
              <a class="px-3 py-2 border-right text-black text-center" target="_blank" href="https://www.instagram.com/havefocusgroups/"><i class="fab fa-instagram"></i></a>
            </div>
          </div>
        </div>

        <nav class="navbar navbar-expand-md navbar-light">
          <div class="container">
            <a class="navbar-brand" href="index.html"><img src="logo.png" alt="Brand Logo" /></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ml-auto py-4 py-md-0">
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3"><a class="nav-link" href="about-us.html">About</a></li>
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3"><a class="nav-link" href="services.html">Services</a></li>
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3"><a class="nav-link" href="healthcheck-plans.html">Health Plans</a></li>
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3"><a class="nav-link" href="location.html">Location</a></li>
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3"><a class="nav-link" href="contact.html">Contact</a></li>
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3"><a class="nav-link" href="faqs.html">Faqs</a></li>
                <li class="nav-item px-2 px-md-0 mx-0 mx-md-3 active"><a class="nav-link" href="check-result.html">Check Result</a></li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <div class="content-area py-5">
      <div class="container">
        <!-- Logo -->
        <div class="text-center mb-4">
          <img src="logo.png" alt="Company Logo" class="img-fluid" style="max-height: 100px;">
        </div>

        <h2 class="page-heading text-center mb-4">Check Patient's Result</h2>

        <div class="card p-4 shadow-sm">
          <form id="resultForm">
            <div class="form-group">
              <label for="uniqueId">Enter Your Unique ID</label>
              <input type="text" id="uniqueId" class="form-control" placeholder="E.g. HFML123456" required />
            </div>
            <button type="submit" class="btn btn-primary btn-block">Check Result</button>
          </form>
        </div>

        <!-- Result Display -->
        <div id="resultStatus" class="mt-4 d-none">
          <div class="alert font-weight-bold text-center" role="alert"></div>
          <div id="resultDate" class="text-center font-weight-bold"></div>
          <div class="text-center">
            <a id="downloadBtn" href="#" class="btn btn-success mt-3 d-none" download>Download Result</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="curve"></div>
      <div class="container">
        <!-- Paste your original footer HTML from the uploaded file here -->
      </div>
      <div class="sub-footer text-center bg-primary p-3">
        <span class="text-white">Copyright Â© 2025. All Rights Reserved.</span>
      </div>
    </footer>
  </section>

  <!-- Vendor Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="scripts/external/slick.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>

  <!-- Custom Scripts -->
  <script src="scripts/validation/jquery.validate.js"></script>
  <script src="scripts/common.js"></script>
  <script src="scripts/counter.js"></script>

  <!-- Page Script -->
  <script>
$("#resultForm").on("submit", function(e) {
  e.preventDefault();

  const id = $("#uniqueId").val().trim();
  const resultStatus = $("#resultStatus");
  const alertBox = resultStatus.find(".alert");
  const resultDate = $("#resultDate");
  const downloadBtn = $("#downloadBtn");

  // Clear previous results
  alertBox.removeClass().addClass("alert alert-info").text("Checking...");
  resultDate.text("");
  downloadBtn.addClass("d-none");
  resultStatus.removeClass("d-none");

  $.ajax({
    url: "https://hfocusmedical.onrender.com/api/appointments/" + id,
    method: "GET",
    success: function(resp) {
      if (resp.status === 1 && resp.data) {
        const appointment = resp.data;
        
        // Check if result is ready and file exists
        if (appointment.result_ready && appointment.result_file) {
          alertBox.removeClass().addClass("alert alert-success").html(
            '<i class="fas fa-check-circle"></i> <strong>Result is Ready!</strong><br>' +
            '<small>Your test results have been uploaded by the doctor and are ready for download.</small>'
          );
          
          resultDate.html(
            '<div class="row mt-3">' +
              '<div class="col-md-6"><strong>Patient:</strong> ' + appointment.first_name + ' ' + appointment.last_name + '</div>' +
              '<div class="col-md-6"><strong>Department:</strong> ' + appointment.department + '</div>' +
              '<div class="col-md-6"><strong>Appointment Date:</strong> ' + appointment.appointment_date + '</div>' +
              '<div class="col-md-6"><strong>Booking ID:</strong> ' + appointment.booking_id + '</div>' +
            '</div>'
          );
          
          // Set the actual result file path
          downloadBtn.removeClass("d-none")
                    .attr("href", appointment.result_file)
                    .attr("download", "Result_" + appointment.unique_id + ".pdf")
                    .html('<i class="fas fa-download"></i> Download Your Result');
        } else {
          alertBox.removeClass().addClass("alert alert-warning").html(
            '<i class="fas fa-clock"></i> <strong>Result Not Ready Yet</strong><br>' +
            '<small>Your test results are still being processed. Please check back later or contact the lab.</small>'
          );
          
          resultDate.html(
            '<div class="row mt-3">' +
              '<div class="col-md-6"><strong>Patient:</strong> ' + appointment.first_name + ' ' + appointment.last_name + '</div>' +
              '<div class="col-md-6"><strong>Department:</strong> ' + appointment.department + '</div>' +
              '<div class="col-md-6"><strong>Appointment Date:</strong> ' + appointment.appointment_date + '</div>' +
              '<div class="col-md-6"><strong>Status:</strong> <span class="text-warning">Processing</span></div>' +
            '</div>'
          );
          
          downloadBtn.addClass("d-none");
        }
      } else {
        alertBox.removeClass().addClass("alert alert-danger").html(
          '<i class="fas fa-exclamation-triangle"></i> <strong>No Record Found</strong><br>' +
          '<small>Please check your Unique ID and try again. If you continue to have issues, contact our support team.</small>'
        );
        resultDate.text("");
        downloadBtn.addClass("d-none");
      }
    },
    error: function(xhr, status, error) {
      console.error('Error:', error);
      alertBox.removeClass().addClass("alert alert-danger").html(
        '<i class="fas fa-exclamation-circle"></i> <strong>Server Error</strong><br>' +
        '<small>Unable to connect to the server. Please try again later or contact support.</small>'
      );
      resultDate.text("");
      downloadBtn.addClass("d-none");
    }
  });
});


  </script>
</body>
</html>
